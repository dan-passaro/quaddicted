{% extends "maps/base.html" %}
{% load static %}

{% block content %}
{%     if map_list %}

<section class="row">
	<div class="col">
		<h1 class="text-center">Maps</h1>

		<form class="form-inline" action="" method="get">
			<div class="form-group mr-2 mb-2">
				<input type="search"
				       name="search"
				       id="map-table-filter"
				       class="form-control"
				       data-table="map-list-table"
				       placeholder="Filter/Search"
				       value="{% if search_term %}{{ search_term }}{% endif %}">
			</div>
			<noscript>
				<button type="submit" class="btn btn-primary mb-2">Search</button>
			</noscript>
		</form>

		<table class="table" id="map-list-table">
			<thead>
				<tr>
					<th><a href="?sort={{ sort_fields.0 }}{{ qs_wo_sort }}">Title</a></th>
					<th>Author(s)</th>
					<th><a href="?sort={{ sort_fields.1 }}{{ qs_wo_sort }}">Date</a></th>
					<th><a href="?sort={{ sort_fields.2 }}{{ qs_wo_sort }}">Rating</a></th>
					<th>Comments</th>
					<th>Tags</th>
				</tr>
			</thead>
			<tbody>
{%         for map in map_list %}
				<tr>
					<td><a href="{% url 'maps:detail' map.id %}">{{ map.name }}</a></td>
					<td>
{%             for author in map.authors.all %}
						<a href="?author={{ author.id }}" title="Show only this users maps">{{ author }}</a>{% if not forloop.last %}, {% endif %}
{%             endfor %}
					</td>
					<td>{{ map.created }}</td>
					<td class="text-nowrap">
{%             if map.rating %}
{%               for n in ""|ljust:map.rating %}
						<span class="icon" title="{{ map.rating }}">
							<i class="fas fa-heart"></i>
						</span>
{%               endfor %}
						<noscript>{{ map.rating }}</noscript>
{%             endif %}
					</td>
					<td>{{ map.num_reviews|default:'0' }}</td>
					<td>
{%             for tag in map.tags.all %}
						<div class="btn-group btn-group-sm mb-1">
						{% if tag.id in tag_list %}
							<a href="?tag={{ tag.id }}{{ qs_wo_tags }}"
							   class="btn btn-secondary">
								{{ tag }}
							</a>
						{% else %}
							<a href="?tag={{ tag.id }}{{ qs_wo_tags }}"
							   class="btn btn-primary">
								{{ tag }}
							</a>
							<a href="?{{ qs }}&tag={{ tag.id }}"
							   class="btn btn-primary">
								<i class="fas fa-plus"></i>
							</a>
						{% endif %}
						</div>
{%             endfor %}
					</td>
				</tr>
{%         endfor %}
			</tbody>
		</table>
	</div>
</section>

{% else %}
<section class="section">
	<div class="container">
		<p>No maps available</p>
	</div>
</section>
{% endif %}

{% endblock %}


{% block javascript %}
	<script>
		(function($){
		    "use strict";
			$(document).ready(function() {
				$("#map-table-filter").on("change keyup paste", function() {
					var value = $(this).val().toLowerCase();

					$("#map-list-table tr").filter(function() {
						$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
					});
				});
			});
		}(jQuery));
	</script>
{% endblock %}