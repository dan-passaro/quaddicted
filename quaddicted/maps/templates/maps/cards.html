{% extends "maps/base.html" %}

{% load static %}

{% block content %}
{%     if map_list %}
<section class="row">
	<div class="col">
		<h1>Cards</h1>

		<form class="form-inline" action="" method="get">
			<div class="form-group mr-2 mb-2">
				<input type="search"
				       name="search"
				       id="map-card-filter"
				       class="form-control"
				       data-cards="map-list-cards"
				       placeholder="Filter/Search"
				       value="{% if search_term %}{{ search_term }}{% endif %}">
			</div>
			<button type="submit" class="btn btn-primary mb-2">Search</button>
		</form>

		<div class="row row-cols-3" id="map-list-cards">
{%     for map in map_list %}
			<div class="col-4 mb-3">
				<div class="card h-100">
					<a href="{% url 'maps:detail' map.id %}">
						{% if map.screenshots.all %}
						<img src="{{ map.screenshots.all.0.thumbnail.url }}" class="card-img-top" style="max-height: 195.75px">
						{% else %}
						<img src="{% static '/384x216.png' %}" class="card-img-top">
						{% endif %}
					</a>
					<div class="card-body">
						<h5 class="card-text">
							<a href="{% url 'maps:detail' map.id %}" class="text-reset">
								{{ map.name }}
							</a>
						</h5>
						<p class="card-text">
{%             for author in map.authors.all %}
							<a href="?author={{ author.id }}" title="Show only this users maps">{{ author }}</a>{% if not forloop.last %}, {% endif %}
{%             endfor %}
						</p>

						<p class="card-text">
{%         for tag in map.tags.all %}
							<a class="badge badge-light" href="?tag={{ tag.id }}">{{ tag }}</a>
{%         endfor %}
						</p>
					</div>
					<div class="card-footer">
						<p class="card-text">
							<time datetime="{{ map.created }}">{{ map.created }}</time>
						</p>
					</div>
				</div>
			</div>
{%     endfor %}
		</div>
	</div>
</section>


{%     else %}
<section class="section">
	<div class="container">
		<p>No maps available</p>
	</div>
</section>
{%     endif %}

{% endblock %}


{% block javascript %}
	<script>
		(function($){
		    "use strict";
			$(document).ready(function() {
				$("#map-card-filter").on("change keyup paste", function() {
					var value = $(this).val().toLowerCase();

					$("#map-list-cards > *").filter(function() {
						$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
					});
				});
			});
		}(jQuery));
	</script>
{% endblock %}